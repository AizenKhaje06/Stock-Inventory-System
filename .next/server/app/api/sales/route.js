(()=>{var e={};e.id=678,e.ids=[678],e.modules={1708:e=>{"use strict";e.exports=require("node:process")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},4573:e=>{"use strict";e.exports=require("node:buffer")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},11723:e=>{"use strict";e.exports=require("querystring")},12412:e=>{"use strict";e.exports=require("assert")},17546:()=>{},19771:e=>{"use strict";e.exports=require("process")},21820:e=>{"use strict";e.exports=require("os")},27910:e=>{"use strict";e.exports=require("stream")},28354:e=>{"use strict";e.exports=require("util")},29021:e=>{"use strict";e.exports=require("fs")},29024:(e,t,r)=>{"use strict";r.d(t,{Fv:()=>c,I0:()=>y,Nl:()=>p,SX:()=>v,T$:()=>l,ao:()=>w,jM:()=>d,tk:()=>x,yY:()=>m});var s=r(67689),a=r(60008),i=r(59493);let n=["https://www.googleapis.com/auth/spreadsheets"],o=e=>(0,a.GP)(e,"yyyy-MM-dd / hh:mm a");async function u(){let e=new s.q7g.auth.GoogleAuth({credentials:{client_email:process.env.GOOGLE_CLIENT_EMAIL,private_key:process.env.GOOGLE_PRIVATE_KEY?.replace(/\\n/g,"\n")},scopes:n});return s.q7g.sheets({version:"v4",auth:e})}async function p(){let e=await u(),t=process.env.GOOGLE_SHEET_ID;return((await e.spreadsheets.values.get({spreadsheetId:t,range:"Inventory!A2:J"})).data.values||[]).map(e=>({id:e[0]||"",name:e[1]||"",sku:e[2]||"",category:e[3]||"",quantity:Number.parseInt(e[4]||"0"),costPrice:Number.parseFloat(e[5]||"0"),sellingPrice:Number.parseFloat(e[6]||"0"),reorderLevel:Number.parseInt(e[7]||"0"),supplier:e[8]||"",lastUpdated:e[9]||o(new Date)}))}async function d(e){let t=await u(),r=process.env.GOOGLE_SHEET_ID,s=`ITEM-${Date.now()}`,a=o(new Date),i=[[s,e.name,e.sku,e.category,e.quantity,e.costPrice,e.sellingPrice,e.reorderLevel,e.supplier,a]];return await t.spreadsheets.values.append({spreadsheetId:r,range:"Inventory!A:J",valueInputOption:"RAW",requestBody:{values:i}}),{...e,id:s,lastUpdated:a}}async function c(e,t){let r=await u(),s=process.env.GOOGLE_SHEET_ID,a=(await p()).findIndex(t=>t.id===e);if(-1===a)throw Error("Item not found");let i=a+2;t.lastUpdated||(t.lastUpdated=o(new Date));let n={id:0,name:1,sku:2,category:3,quantity:4,costPrice:5,sellingPrice:6,reorderLevel:7,supplier:8,lastUpdated:9},d=[];for(let[e,r]of Object.entries(t)){let t=n[e];if(void 0!==t&&void 0!==r){let e;if("number"==typeof r)e={numberValue:r};else{if("string"!=typeof r)continue;e={stringValue:r}}d.push({updateCells:{range:{sheetId:0,startRowIndex:i-1,endRowIndex:i,startColumnIndex:t,endColumnIndex:t+1},fields:"userEnteredValue",rows:[{values:[{userEnteredValue:e}]}]}})}}d.length>0&&await r.spreadsheets.batchUpdate({spreadsheetId:s,requestBody:{requests:d}})}async function l(e){let t=await u(),r=process.env.GOOGLE_SHEET_ID,s=(await p()).findIndex(t=>t.id===e);if(-1===s)throw Error("Item not found");let a=s+2;await t.spreadsheets.batchUpdate({spreadsheetId:r,requestBody:{requests:[{deleteDimension:{range:{sheetId:0,dimension:"ROWS",startIndex:a-1,endIndex:a}}}]}})}async function m(e){let t=await u(),r=process.env.GOOGLE_SHEET_ID,s=`TXN-${Date.now()}`,a=o(new Date),i=[[s,e.itemId,e.itemName,e.quantity,e.costPrice,e.sellingPrice,e.totalCost,e.totalRevenue,e.profit,a,e.type,e.paymentMethod,e.referenceNumber||""]];return await t.spreadsheets.values.append({spreadsheetId:r,range:"Transactions!A:M",valueInputOption:"RAW",requestBody:{values:i}}),{...e,id:s,timestamp:a}}async function y(){let e=await u(),t=process.env.GOOGLE_SHEET_ID;return((await e.spreadsheets.values.get({spreadsheetId:t,range:"Transactions!A2:M"})).data.values||[]).map(e=>({id:e[0]||"",itemId:e[1]||"",itemName:e[2]||"",quantity:Number.parseInt(e[3]||"0"),costPrice:Number.parseFloat(e[4]||"0"),sellingPrice:Number.parseFloat(e[5]||"0"),totalCost:Number.parseFloat(e[6]||"0"),totalRevenue:Number.parseFloat(e[7]||"0"),profit:Number.parseFloat(e[8]||"0"),timestamp:e[9]||"",type:e[10]||"sale",paymentMethod:e[11]||"cash",referenceNumber:e[12]||""}))}async function q(){let e=await u(),t=process.env.GOOGLE_SHEET_ID;try{await e.spreadsheets.values.get({spreadsheetId:t,range:"Logs!A1:F1"})}catch(r){await e.spreadsheets.batchUpdate({spreadsheetId:t,requestBody:{requests:[{addSheet:{properties:{title:"Logs",gridProperties:{rowCount:1e3,columnCount:6}}}}]}}),await e.spreadsheets.values.update({spreadsheetId:t,range:"Logs!A1:F1",valueInputOption:"RAW",requestBody:{values:[["ID","Operation","Item ID","Item Name","Details","Timestamp"]]}})}}async function v(e){await q();let t=await u(),r=process.env.GOOGLE_SHEET_ID,s=`LOG-${Date.now()}`,a=o(new Date),i=[[s,e.operation,e.itemId||"",e.itemName||"",e.details,a]];return await t.spreadsheets.values.append({spreadsheetId:r,range:"Logs!A:F",valueInputOption:"RAW",requestBody:{values:i}}),{...e,id:s,timestamp:a}}async function w(){await q();let e=await u(),t=process.env.GOOGLE_SHEET_ID;return((await e.spreadsheets.values.get({spreadsheetId:t,range:"Logs!A2:F"})).data.values||[]).map(e=>({id:e[0]||"",operation:e[1]||"",itemId:e[2]||"",itemName:e[3]||"",details:e[4]||"",timestamp:e[5]||""})).sort((e,t)=>(0,i.qg)(t.timestamp,"yyyy-MM-dd / hh:mm a",new Date).getTime()-(0,i.qg)(e.timestamp,"yyyy-MM-dd / hh:mm a",new Date).getTime())}async function h(){let e=await u(),t=process.env.GOOGLE_SHEET_ID;try{await e.spreadsheets.values.get({spreadsheetId:t,range:"Restock!A1:G1"})}catch(r){await e.spreadsheets.batchUpdate({spreadsheetId:t,requestBody:{requests:[{addSheet:{properties:{title:"Restock",gridProperties:{rowCount:1e3,columnCount:7}}}}]}}),await e.spreadsheets.values.update({spreadsheetId:t,range:"Restock!A1:G1",valueInputOption:"RAW",requestBody:{values:[["ID","Item ID","Item Name","Quantity Added","Cost Price","Total Cost","Timestamp"]]}})}}async function x(e){await h();let t=await u(),r=process.env.GOOGLE_SHEET_ID,s=`RSTK-${Date.now()}`,a=o(new Date),i=[[s,e.itemId,e.itemName,e.quantity,e.costPrice,e.totalCost,a]];return await t.spreadsheets.values.append({spreadsheetId:r,range:"Restock!A:G",valueInputOption:"RAW",requestBody:{values:i}}),{...e,id:s,timestamp:a}}},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},33873:e=>{"use strict";e.exports=require("path")},34631:e=>{"use strict";e.exports=require("tls")},37067:e=>{"use strict";e.exports=require("node:http")},37830:e=>{"use strict";e.exports=require("node:stream/web")},38522:e=>{"use strict";e.exports=require("node:zlib")},44708:e=>{"use strict";e.exports=require("node:https")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},50755:e=>{"use strict";e.exports=require("node:url")},55511:e=>{"use strict";e.exports=require("crypto")},55591:e=>{"use strict";e.exports=require("https")},57075:e=>{"use strict";e.exports=require("node:stream")},57975:e=>{"use strict";e.exports=require("node:util")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},73024:e=>{"use strict";e.exports=require("node:fs")},73496:e=>{"use strict";e.exports=require("http2")},73566:e=>{"use strict";e.exports=require("worker_threads")},74075:e=>{"use strict";e.exports=require("zlib")},76760:e=>{"use strict";e.exports=require("node:path")},77030:e=>{"use strict";e.exports=require("node:net")},77441:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>y,routeModule:()=>d,serverHooks:()=>m,workAsyncStorage:()=>c,workUnitAsyncStorage:()=>l});var s={};r.r(s),r.d(s,{POST:()=>p});var a=r(45002),i=r(89587),n=r(1202),o=r(24715),u=r(29024);async function p(e){try{let{items:t,paymentMethod:r,referenceNumber:s}=await e.json();if(!r)return o.NextResponse.json({error:"Payment method is required"},{status:400});if("cash"!==r&&!s)return o.NextResponse.json({error:"Reference number is required for E-Wallet payments"},{status:400});let a=await (0,u.Nl)(),i=[];for(let e of t){let t=a.find(t=>t.id===e.itemId);if(!t)return o.NextResponse.json({error:`Item ${e.itemId} not found`},{status:404});if(t.quantity<e.quantity)return o.NextResponse.json({error:`Insufficient stock for ${t.name}`},{status:400});let n=t.costPrice*e.quantity,p=t.sellingPrice*e.quantity,d=p-n,c=await (0,u.yY)({itemId:t.id,itemName:t.name,quantity:e.quantity,costPrice:t.costPrice,sellingPrice:t.sellingPrice,totalCost:n,totalRevenue:p,profit:d,type:"sale",paymentMethod:r,referenceNumber:"cash"===r?void 0:s});await (0,u.Fv)(t.id,{quantity:t.quantity-e.quantity}),await (0,u.SX)({operation:"sale",itemId:t.id,itemName:t.name,details:`Sold "${t.name}" - Qty: ${e.quantity}, Total: â‚±${p.toFixed(2)}, Method: ${r}${s?` (Ref: ${s})`:""}`}),i.push(c)}return o.NextResponse.json({transactions:i})}catch(e){return console.error("[v0] Error processing sale:",e),o.NextResponse.json({error:"Failed to process sale"},{status:500})}}let d=new a.AppRouteRouteModule({definition:{kind:i.RouteKind.APP_ROUTE,page:"/api/sales/route",pathname:"/api/sales",filename:"route",bundlePath:"app/api/sales/route"},resolvedPagePath:"C:\\Inventory Management System\\Inventory-Management-System\\app\\api\\sales\\route.ts",nextConfigOutput:"",userland:s}),{workAsyncStorage:c,workUnitAsyncStorage:l,serverHooks:m}=d;function y(){return(0,n.patchFetch)({workAsyncStorage:c,workUnitAsyncStorage:l})}},79428:e=>{"use strict";e.exports=require("buffer")},79551:e=>{"use strict";e.exports=require("url")},79646:e=>{"use strict";e.exports=require("child_process")},80594:()=>{},81630:e=>{"use strict";e.exports=require("http")},83997:e=>{"use strict";e.exports=require("tty")},91645:e=>{"use strict";e.exports=require("net")},94735:e=>{"use strict";e.exports=require("events")}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[555,520,700],()=>r(77441));module.exports=s})();